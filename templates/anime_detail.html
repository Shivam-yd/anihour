{% extends "base.html" %}

{% block title %}{{ anime_title|default('Anime Details') }} - Watch & Track on Anihour | {{ current_year }}{% endblock %}

{% block description %}{{ anime_synopsis|default('Discover detailed information about this anime series including plot, characters, ratings, and where to watch.') }} Watch and track {{ anime_title|default('anime') }} on Anihour.{% endblock %}

{% block keywords %}{{ anime_title|default('anime') }}, anime {{ current_year }}, watch anime, anime series, anime characters, MyAnimeList, anime ratings, anime review{% endblock %}

{% block og_type %}video.tv_show{% endblock %}
{% block og_title %}{{ anime_title|default('Anime Details') }} - Complete Guide & Where to Watch{% endblock %}
{% block og_image %}{{ anime_image|default(url_for('static', filename='images/anihour-og-image.jpg', _external=True)) }}{% endblock %}

{% block structured_data %}
<script type="application/ld+json" id="anime-schema">
{
  "@context": "https://schema.org",
  "@type": "TVSeries",
  "name": "{{ anime_title|default('Anime Title') }}",
  "description": "{{ anime_synopsis|default('Anime description') }}",
  "image": "{{ anime_image|default('') }}",
  "genre": {{ anime_genres|default('["Animation", "Drama"]')|safe }},
  "numberOfEpisodes": "{{ anime_episodes|default('Unknown') }}",
  "datePublished": "{{ anime_aired_from|default('') }}",
  "contentRating": "{{ anime_rating|default('') }}",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ anime_score|default(0) }}",
    "bestRating": "10",
    "worstRating": "1",
    "ratingCount": "{{ anime_scored_by|default(0) }}"
  },
  "productionCompany": {
    "@type": "Organization",
    "name": "{{ anime_studio|default('Studio') }}"
  },
  "creator": {
    "@type": "Person",
    "name": "{{ anime_author|default('') }}"
  },
  "url": "{{ request.url }}",
  "sameAs": "{{ anime_mal_url|default('') }}"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ url_for('index', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Anime Details",
      "item": "{{ request.url }}"
    }
  ]
}
</script>
{% endblock %}

{% block content %}
<div class="container mt-5 pt-5">
    <div id="animeDetailsContent">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Loading anime details...</p>
        </div>
    </div>
    
    <!-- Back Button -->
    <div class="mt-4">
        <button onclick="history.back()" class="btn btn-outline-light">
            <i class="fas fa-arrow-left me-2"></i>Back
        </button>
    </div>
</div>

<!-- Decorative Background -->
<div class="position-fixed w-100 h-100" style="top: 0; left: 0; z-index: -2; opacity: 0.03;">
    <div class="bg-pattern h-100"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get anime ID from URL
    const pathParts = window.location.pathname.split('/');
    const animeId = pathParts[pathParts.length - 1];
    
    if (animeId && !isNaN(animeId)) {
        // The main.js will handle loading the details
        console.log('Loading details for anime ID:', animeId);
    } else {
        document.getElementById('animeDetailsContent').innerHTML = `
            <div class="error-message">
                <div class="error-title">Invalid Anime ID</div>
                <p>The anime ID in the URL is not valid.</p>
                <a href="/" class="btn btn-primary">Go Home</a>
            </div>
        `;
    }
});
</script>
{% endblock %}
